> 引用：http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html

### 什么是同源策略（跨域访问限制）
  是一种所有浏览器都在实行的政策。**浏览器** 出于安全的考虑，会限制从**脚本发出**的跨域**HTTP请求**。
  
  1. 首先，是浏览器做出的限制。因此如果是代理服务器发出的跨域访问，不算该限制。
  2. HTTP请求才会受到跨域访问限制，WebSocket协议不受限制。  
  （3. 例如，`XMLHttpRequest` 和 `Fetch API` 遵循同源策略。这意味着使用这些 API 的 Web 应用程序只能从加载应用程序的同一个域请求 HTTP 资源，*除非响应报文包含了正确 CORS 响应头*。

### 什么行为收到跨域访问限制
  1. Cookie、LocalStorage 和 IndexDB 无法读取。
  2. DOM 无法获得。（例如iframe不能获得父窗口的DOM
  3. AJAX 请求不能发送。（前后端分离时，前端网页部署在不同服务器，前端无法请求后端数据

### 如何避免上述限制
  #### 1. Cookie
   Cookie 是服务器写入浏览器的一小段信息，只有同源的网页才能共享。但是，两个网页一级域名相同，只是二级域名不同，浏览器允许通过设置`document.domain`共享 `Cookie`。

   > `LocalStorage` 和 `IndexDB` 无法通过这种方法，规避同源政策，而要使用下文介绍的`PostMessage API`。
  
  #### 2. DOM访问
    如果两个网页不同源，就无法拿到对方的DOM。典型的例子是`iframe`窗口和`window.open`方法打开的窗口，它们与父窗口无法通信。
    有3个解决办法，最主要的是
  
   * 跨文档通信API（Cross-document messaging）
    HTML5引入了一个全新的API：跨文档通信 API。这个API为window对象新增了一个`window.postMessage`方法，允许跨窗口通信。

  #### 3. AJax请求（实际上是前后端部署在不同的服务器时，前端通过JavaScript在后台与服务器进行数据交换的技术行为
    同源政策规定，AJAX请求只能发给同源的网址，否则就报错。

    除了架设**服务器代理**（浏览器请求同源服务器，再由后者请求外部服务，可由前端程序员完成），有三种方法规避这个限制。

   1. *JSONP*
     需要后端配合实现。利用`<script>`元素不限制跨域实现。实现后端数据发送到前端，模拟Ajax请求。
     * 原理是：由前端定义一个全局上的回调函数，并在一个script标签的src中访问跨域网页url，后端执行这个回调函数，并将数据作为参数返回。(代码见JSONP.js)
     
     CORS与JSONP的使用目的相同，但是比JSONP更强大。  
     JSONP只支持GET请求，CORS支持所有类型的HTTP请求。JSONP的优势在于支持老式浏览器，以及可以向不支持CORS的网站请求数据。
   
   2. WebSocket
     * 该协议不实行同源政策，只要服务器支持，就可以通过它进行跨源通信。
     * 原理是：其请求报文中有`origin`字段，服务器可以据此知道请求来源，了解来源是否在访问白名单内，从而决定是否允许通信。
   
   3. CORS
     * 需要浏览器和服务器两方的配合完成。
